# План реализации функционала сбора метрик производительности

## 1. Создание API endpoint

- [x] Создать файл `src/app/api/performance/route.ts`
- [ ] Реализовать обработчик GET запроса
- [ ] Поддержка параметров:
  - `module`: тестируемый модуль (`genetic`, `lp`, `graph`)
  - `min`: минимальный размер входных данных (по умолчанию 1)
  - `max`: максимальный размер входных данных (по умолчанию 10)
  - `step`: шаг увеличения размера данных (по умолчанию 1)
  - `iterations`: количество повторений теста (по умолчанию 3)
  - `dataSource`: источник данных (`auto` или `stored`)

## 2. Реализация генерации тестовых данных

- [ ] Режим `auto`:
  - Для genetic: генерация случайных перестановок
  - Для lp: генерация случайных товаров и ячеек
  - Для graph: генерация случайной сетки
- [ ] Режим `stored`: использование готовых данных из `src/storages/init-data.ts`
- [ ] Реализовать функцию `generateTestData(module, size)` в `src/modules/performance/utils.ts`

## 3. Реализация тестовых сценариев

- [ ] Для genetic: измерение времени `findSolution()`
- [ ] Для lp: измерение времени `solvePlacement()`
- [ ] Для graph: измерение времени `findPath()`
- [ ] Реализовать функцию `runPerformanceTest(module, inputData)`

## 4. Процесс тестирования

- [ ] Для каждого размера от min до max с шагом step:
  - [ ] Генерация входных данных
  - [ ] Запуск теста указанное количество раз
  - [ ] Расчет среднего времени выполнения
  - [ ] Сохранение результата (размер данных, время)

## 5. Формирование результатов

- [ ] Сбор результатов в массив объектов:
  ```ts
  {
    module: string,
    inputSize: number,
    timeMs: number
  }
  ```
- [ ] Генерация CSV строки:
  ```
  Module,InputSize,TimeMs
  genetic,1,15.2
  genetic,2,28.7
  ...
  ```

## 6. Возврат результатов

- [ ] Установка заголовков для скачивания файла:
  ```ts
  headers.set('Content-Type', 'text/csv');
  headers.set('Content-Disposition', 'attachment; filename="metrics.csv"');
  ```
- [ ] Возврат сгенерированной CSV строки

## 7. Интеграция с системой

- [ ] Добавить экспорт новых функций в `src/modules/index.ts`
- [ ] Обновить документацию в `docs/ru/pages/performance-metrics.md`
- [ ] Добавить обработку ошибок и валидацию параметров

## 8. Дополнительные улучшения

- [ ] Кеширование результатов тестов
- [ ] Ограничение максимального размера данных (max <= 100)
- [ ] Логирование процесса выполнения

## Пример использования API

```bash
curl "http://localhost:3000/api/performance?module=genetic&min=1&max=10&step=1&iterations=3"
```

Пример ответа:

```csv
Module,InputSize,TimeMs
genetic,1,15.2
genetic,2,28.7
genetic,3,42.1
...
```

## Формат CSV отчета

Отчет содержит следующие колонки:

1. `Module` - тестируемый модуль (genetic, lp, graph)
2. `InputSize` - размер входных данных
3. `TimeMs` - среднее время выполнения в миллисекундах
